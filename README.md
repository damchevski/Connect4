# Connect4
Проект по предметот Визуелно Програмирање
Изработено од: Анѓелче Дамчевски (181100) и Сашко Клинчаров (181257)

# За проектот
Во рамките на овој проект е имплементирана стратегиската игра Connect4.
За играта се потребни двајца играчи, од кои првиот играч и неговите топчиња се означени со жолта, а вториот со црвена боја.
На самата форма е поставена табла (7 колони и 6 редици), на која играчите наизменично поставуваат по едно од нивните топчиња.
Играта завршува кога еден од играчите ќе успее да нареди четири последователни топчиња. Топчињата се сметаат наредени последователно доколку се наредени во една од следните насоки: хоризонтално, вертикално или дијагонално. Топчињата не мора да почнуваат од нултата редица/колона.

Во следното [видео](https://www.youtube.com/watch?v=YqqcNjQMX18) е прикажана играта и една од стратегиите како полесно да се победи противникот.

# Опис на решението
Играта е изработена во Visual Studio со користење на Windows Forms апликација.
Искористени се две форми, од кои првата се користи за внесување на имиња на играчите и копче за почеток на играта, а втората е самата игра. Во втората форма е прикажана таблата за играње, која во позадина претставува матрица исполнета на почеток со празни топчиња. За потребите на апликацијата се искористени класи за:

Играч - class Player во која се чуваат информации за неговото име (string), дали е на ред (bool) и дали завршил со играта, односно дали победил (bool).

Топче - class Ball во која се чуваат информации за неговата боја (Color), дали е активно (на почетокот сите топчиња се неактивни/празни, bool), локација каде што треба да се исцрта (Point), радиус (int) и на кој играч припаѓа соодветното топче (int).

Сцена - class Scene која претставува инстанца од играта во која се чуваат двајцата играчи (Player), матрицата со топчињата (Ball[,]), листа од топчиња кои што ја формираат победничката низа (List<Ball>) и колку пати тие треба да пулсираат - ticks (int).

На почетокот на играта се креира нова инстанца од класата Сцена во која се внесуваат имињата на играчите кои што предходно се внесени во првата форма и се инстанцира матрицата со празни топчиња. Главната функција е Connect4_MouseClick со која се детектира дека играчот кликнал на формата и се преземаат определени акции. Имплементацијата на оваа функција и објаснувањето на нејзините акции е следна:

```csharp
 private void Connect4_MouseClick(object sender, MouseEventArgs e)
        {
        
         /// <summary>
        /// Најпрво со овој if се проверува дали можеби некој од играчите победил во предходниот чекор,
        /// па е направен дополнителен клик кој се смета за невалиден.
        /// </summary>
        
            if(scena.player1.daliZavrsil || scena.player2.daliZavrsil)
            {
            
            /// <summary>
            /// Доколку е направен таков клик, се појавува дијалог со кој се прашува дали сакаме да започнеме нова игра. 
            /// Ако е избрано Yes, се затвара тековниот прозорец и се враќаме на првата форма. Ако е избрано No се продолжува со
            /// играта.
            /// </summary>
            
            if(MessageBox.Show("Дали сакате нова игра ?", "Играта заврши !", MessageBoxButtons.YesNo, MessageBoxIcon.Question) == DialogResult.Yes)
                {
                    this.Close();
                    return;
                }
                else
                {
                    return;
                }
            }
            
           /// <summary>
           /// Променливата kolona служи за да се означи во која колона е кликнато и потоа тоа се искористува за да можеме да 
           /// поставиме топче во соодветната колона.
           /// Променливата играч ќе ја земе вредноста на играчот кој што тековно го направил кликот.
           /// </summary>
        
            int kolona = -1;
            int igrac = -1;
          
          /// <summary>
          /// Поставување на вредност за igrac, ако играч 1 е на ред igrac=1, ако играч 2 е на ред igrac=2.
          /// </summary>
        
            if (scena.player1.turn)
            {
                igrac = 1;
            }else if (scena.player2.turn)
            {
                igrac = 2;
            }
            
            /// <summary>
            /// Со следниве if циклуси определува во која колона е кликнато според позицијата на кликот.
            /// Со помош на координатите X и Y определува од-до позиција која се однесува на секоја од колоните
            /// и резултатот го зачувуваме во променливата kolona.
            /// <summary>
            
            if (e.X > 70 && e.X < 160)
            {
                kolona = 0;
            }  
            else if (e.X > 170 && e.X < 260)
            {
                kolona = 1;
            }
            else if (e.X > 270 && e.X < 360)
            {
                kolona = 2;
            }
            else if (e.X > 370 && e.X < 460)
            {
                kolona = 3;
            }
            else if (e.X > 470 && e.X < 560)
            {
                kolona = 4;
            }
            else if (e.X > 570 && e.X < 660)
            {
                kolona = 5;
            }  
            else if (e.X > 670 && e.X < 760)
            {
                kolona = 6;
            }
            
            /// <summary>
            /// Доколку вредноста на kolona остане -1 значи е кликнато на невалидна позиција па се враќаме назад
            /// <summary>
            
            if(kolona == -1)
            {
                return;
            }
            
            /// <summary>
            /// Променлиавата sakanoI служи за да определиме кое е следно топче кое што треба да биде пополнето
            /// во соодветната редица
            /// <summary>
            
            int sakanoI = -1;
            
            /// <summary>
            /// Со помош на овој for циклус пребарува во соодветната колона се додека не најдеме топче кое што не е активно
            /// соодветно ажурираме sakanoI на i-то каде што е пронајдено топчето и прекинуваме со пребарување
            /// <summary>
            
            for (int i = 0; i < 6; i++)
            {
                if (scena.topcinja[kolona, i].active == false)
                {
                    sakanoI = i;
                    break;
                }
            }
            
            /// <summary>
            /// Доколку sakanoI останало -1 значи во соодветната колона сите топчиња се активни и нема можност
            /// за додавање на ново топче па тогаш се покажува MessageBox за самата грешка
            /// <summary>
            
            if (sakanoI == -1)
            {
                MessageBox.Show("Колоната е полна","Грешка");
                return;
            }
            
            /// <summary>
            /// Со помош на овој if else циклус проверуваме кој играч е на ред па соодветно ако е 1
            /// се покажува лабелата за неготово име, ако е 2 се покажува лабелата за играчот 2
            /// <summary>
            
            if (scena.player1.turn)
            {
                lblPlayer1.Visible = false;
                lblPlayer2.Visible = true;
            }
            else if (scena.player2.turn)
            {
                lblPlayer2.Visible = false;
                lblPlayer1.Visible = true;
            }
            
            /// <summary>
            /// Со функцијата scena.AddBall се додава ново топче во матрицата (т.е. преку променливите kolona и sakanoI го 
            /// имаме саканото топче кое што треба да се постави а преку променлиавата igrac го поставуваме на соодветниот
            /// играч). Топчето реално не се додава бидејќи самото е присутно во матрицата туку се менува неговата вредност
            /// на активна и се поставува на кој играч припаѓа
            /// <summary>
            
            scena.AddBall(kolona, igrac, sakanoI);
            
            /// <summary>
            /// Со Invalidate() го повикуваме paint настанот на формата со кој се повикува DrawAll функцијата на
            /// сцената и ја исцртуваме одново таблата за да се ажурира променетото топче (DrawAll ги изминува сите
            /// топчиња и за секое од нив ја повикува Draw функцијата која го црта топчето)
            /// <summary>
            
            Invalidate();
            
            /// <summary>
            /// Доколку функцијата scena.CheckWin врати true значи дека играта е завршена и еден од играчите
            /// победил. Функцијата checkWin функционира така што ги поминува сите активни топчиња и проверува доколку
            /// соодвето топче прави секвенца (хоризонтално,вертикално или дијагонално) враќа true и ги зачувува
            /// тие топчиња во листата на топчиња за pulse во сцената
            /// Ако имаме ситуација каде што играта е завршена се рестартираат лабелите и се вклучува тајмерот
            /// кој што ќе ќе ги пулсира соодветните топчиња од таа листа, ticks пати колку што имаме во сцената
            /// <summary>
            
            if (scena.CheckWin())
            {
                lblPlayer1.Visible = true;
                lblPlayer2.Visible = true;
                timer1.Start();
            }
            
            /// <summary>
            /// Доколку функцијата погоре не врати дека е крај тогаш треба да направиме проверка дали можеби е нерешено
            /// доколку целата мапа е исполента со активни топчиња а немаме победник тогаш scena.checkDraw ќе врати true
            /// и соодветно ќе се појави MessageBox дали сакаме да започнеме нова игра и ако се одбере Yes се затвара 
            /// моменталниот прозорец и се враќаме на почеток
            /// <summary>
            
            if (scena.checkDraw())
            {
                if (MessageBox.Show("Дали сакате нова игра ?", "Нерешено !", MessageBoxButtons.YesNo, MessageBoxIcon.Question)                            == DialogResult.Yes) 
                {
                    this.Close();
                    return;
                }
                else
                {
                    return;
                }
            }
        }
```
Покрај ова на формата е поставен menu strip со кој се овозможува зачувување, отворање на зачувана игра, започнување на нова игра и затварање на тековна игра. Исто така е поставен и дел за Помош каде што има објаснување како се игра играта. Деловите за зачувување и отварање се имплементира со помош на OpenFileDialog со што се одбира каде ќе се зачува/од каде ќе се отвори игра, и потоа соодветно преку FileStream се презема/зачувува содржината.

# Финален изглед




  
  

